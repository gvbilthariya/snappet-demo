<div class="top-fixed">
  <app-filter [applicationArea]="applicationArea"></app-filter>
</div>
<div class="so-container">
  <div class="flex-box">
    <mat-form-field class="search-form-field">
      <mat-label>Filter by Student Name</mat-label>
      <input #filterValue matInput type="text" (input)="onFilterChange($event)">
      @if (filterValue.value) {
        <button matSuffix mat-icon-button aria-label="Clear"(click)="clearInput(filterValue)">
          <mat-icon>close</mat-icon>
        </button>
      }
    </mat-form-field>
    <div class="table" *ngIf="!(studentsOverViewDataLoading$ | async) && (studentsOverViewData$ | async)!.length > 0; else noRecordsTemplate">
      <table class="mat-table" mat-table [dataSource]="filteredStudentsOverViewData$" class="mat-elevation-z8 box">
        <ng-container matColumnDef="student">
          <th mat-header-cell *matHeaderCellDef> Student </th>
          <td mat-cell *matCellDef="let data"><app-student-indentity [student]="data.student"></app-student-indentity>
          </td>
        </ng-container>
  
        <ng-container matColumnDef="totalExercisesCompleted">
          <th mat-header-cell *matHeaderCellDef> Exercises Completed </th>
          <td mat-cell *matCellDef="let data"> {{ data.exercisesCompleted}} </td>
        </ng-container>
  
        <ng-container matColumnDef="correctAnswers">
          <th mat-header-cell *matHeaderCellDef> Correct Answers </th>
          <td mat-cell *matCellDef="let data"> {{ data.correctAnswers }} </td>
        </ng-container>
  
        <ng-container matColumnDef="averageProgress">
          <th mat-header-cell *matHeaderCellDef> Average Progress </th>
          <td mat-cell *matCellDef="let data"> {{ data.averageProgress}} </td>
        </ng-container>
  
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowClick(row)"></tr>
      </table>
    </div>
  </div>
  <div *ngIf="!(studentsOverViewDataLoading$ | async) && (studentsOverViewData$ | async)!.length > 0 && studentPerformanceDataLoaded" class="student-details">
    <div class="student-detail-container">
      <div class="student-header mat-elevation-z4">
        <img [src]="studentPerformanceData.student.photoUrl" alt="Student Photo" class="student-photo">
        <div class="student-info">
          <h2>{{ studentPerformanceData.student.name }}</h2>
          <p>Class: {{ studentPerformanceData.class }}</p>
          <p>Grade: {{ studentPerformanceData.grade }}</p>
          <p *ngIf="studentPerformanceData.attendance">Attendance: {{ studentPerformanceData.attendance }}%</p>
        </div>
      </div>

      <div class="tabs-section mat-elevation-z4">
        <mat-tab-group>
          <mat-tab label="Subject Breakdown">
            <div class="subject-breakdown">
              <mat-list>
                <mat-list-item class="mat-list" *ngFor="let subject of studentPerformanceData.subjects">
                  <h3 class="text-head1" mat-line>{{ subject.name }}</h3>
                  <p class="text-head2" mat-line>Progress: {{ subject.progress }}%, Correct Answers: {{ subject.correctAnswers }}%</p>
                </mat-list-item>
              </mat-list>
            </div>
          </mat-tab>

          <mat-tab label="Learning Objectives">
            <div class="learning-objectives">
              <mat-list>
                <mat-list-item class="mat-list" *ngFor="let objective of studentPerformanceData.learningObjectives">
                  <h3 class="text-head1" mat-line>{{ objective.name }}</h3>
                  <p class="text-head2" mat-line>Progress: {{ objective.progress }}%</p>
                </mat-list-item>
              </mat-list>
            </div>
          </mat-tab>

          <mat-tab label="Strengths & Weaknesses">
            <div class="strengths-weaknesses">
              <mat-list>
                <mat-list-item class="mat-list">
                  <h3 class="text-head1" mat-line>Strengths</h3>
                  <p class="text-head2" mat-line>{{ studentPerformanceData.strengths }}</p>
                </mat-list-item>
                <mat-list-item class="mat-list">
                  <h3  class="text-head1" mat-line>Weaknesses</h3>
                  <p class="text-head2" mat-line>{{ studentPerformanceData.weaknesses }}</p>
                </mat-list-item>
              </mat-list>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>
    <div class="detail-right">
      <div class="progress mat-elevation-z4"><mat-card>
        <mat-card-title>Progress Overview</mat-card-title>
        <div class="progress-bars">
          <mat-progress-bar mode="determinate" [value]="studentPerformanceData.progress"
            color="primary"></mat-progress-bar>
          <p>Progress: {{ studentPerformanceData.progress }}%</p>
        </div>
        <div class="progress-bars">
          <mat-progress-bar mode="determinate" [value]="studentPerformanceData.correctAnswers"
            color="accent"></mat-progress-bar>
          <p>Correct Answers: {{ studentPerformanceData.correctAnswers }}%</p>
        </div>
      </mat-card>
    </div>
      <div class="recent-activity mat-elevation-z4">
        <mat-card>
          <mat-card-title>Recent Activity</mat-card-title>
          <div class="mat-list" *ngFor="let activity of studentPerformanceData.recentActivities">
            <h4 class="text-head1" mat-line>{{ activity.task }}</h4>
            <p class="text-head2" mat-line>Completion Time: {{ activity.completionTime }}</p>
          </div>
        </mat-card>
      </div>
    </div>
  </div>
</div>
<ng-template #noRecordsTemplate>
  <div class="not-found-content">
    <p><b>No Records Found.</b></p>
    <img src="../../../assets/no-records.PNG">
  </div>
</ng-template>